import 'package:flutter_riverpod/flutter_riverpod.dart';
import '../models/guide_item.dart';
import '../services/local_store.dart';

final _localStoreProvider = Provider((ref) => LocalStore());

final guidesProvider = StateNotifierProvider<GuidesNotifier, List<GuideItem>>((
  ref,
) {
  final store = ref.read(_localStoreProvider);
  return GuidesNotifier(store);
});

class GuidesNotifier extends StateNotifier<List<GuideItem>> {
  final LocalStore _store;

  GuidesNotifier(this._store) : super(const []) {
    _load();
  }

  // ✅ 시연용 가이드(탭 유지: 이력서/자기소개서/면접/첫출근)
  static const List<Map<String, String>> _seedGuides = [
    // -------------------------
    // 이력서
    // -------------------------
    {
      "id": "r01",
      "category": "이력서",
      "title": "이력서 1페이지로 끝내는 레이아웃 규칙",
      "content": """
목표
면접관이 10초 안에 “이 사람 괜찮다” 느낌 받게 만들기.

1페이지 규칙
- 학력/자격/프로젝트/활동/기술스택: 한 페이지 안에 정리
- 줄글 금지, 불릿 + 숫자로 설득

가장 위(헤더)
- 이름 / 연락처 / 이메일 / GitHub(or 포트폴리오 링크)
- 한 줄 요약: “OO을 만드는 OO 개발자(지망)” 같은 정체성

핵심 섹션 순서 추천
1) 요약(3줄)
2) 프로젝트(2~4개)
3) 경험/활동(대회/동아리/인턴 등)
4) 기술 스택
5) 자격증/수상

함정
- “사용 가능: C, C++, Java…” 나열만 하면 의미 없음
  → 프로젝트에서 뭘 했는지로 증명해야 함.
""",
    },
    {
      "id": "r02",
      "category": "이력서",
      "title": "프로젝트 설명: 무조건 먹히는 한 줄 공식",
      "content": """
한 줄 공식
“무엇을(서비스/기능) → 왜(문제) → 어떻게(기술/구조) → 결과(수치/변화)”

예시
- 학교 3D프린터 예약 시스템 개발
  → 대기/중복 예약 문제 해결
  → FastAPI + PostgreSQL + 권한/로그 설계
  → 예약 처리 시간 단축, 관리 업무 감소

체크
- 역할(내가 한 것) 분리해서 적기
- 결과는 숫자 없으면 전/후 변화라도 적기
""",
    },
    {
      "id": "r03",
      "category": "이력서",
      "title": "기술 스택 섹션: ‘알아요’ 말고 ‘써봤어요’로",
      "content": """
스택 표기 3단계
- 사용해봄(튜토리얼 수준)
- 실전 사용(프로젝트에 적용)
- 운영 경험(배포/모니터링/유지보수)

추천 표기 예
- Flutter(실전 사용: 앱 1개 출시/배포 경험)
- FastAPI(실전 사용: REST + WebSocket 구현)
- PostgreSQL(실전 사용: 스키마 설계/쿼리 작성)

금지
- “상/중/하”만 적기 (근거가 없음)
""",
    },

    // -------------------------
    // 자기소개서
    // -------------------------
    {
      "id": "s01",
      "category": "자기소개서",
      "title": "자기소개서 문항 해석법: 질문 의도부터 잡기",
      "content": """
1단계: 문항을 ‘질문 의도’로 번역
예)
- “지원 동기” → 왜 여기인지 + 왜 지금인지
- “성장 과정” → 성격 자랑 X, 행동 패턴/가치관 확인

2단계: 경험 매칭
문항 하나당 경험 1개만 골라서 깊게.

3단계: 구조
- 결론 1문장
- 경험(STAR)
- 배운 점
- 지원 직무 연결
""",
    },
    {
      "id": "s02",
      "category": "자기소개서",
      "title": "자소서 STAR 예시 템플릿 (복붙용)",
      "content": """
템플릿
- (S) 어떤 상황이었고,
- (T) 나는 어떤 목표/역할이었고,
- (A) 내가 한 행동은 무엇이며(3개 이내),
- (R) 결과는 무엇이었고,
- (배움) 다음엔 뭘 더 잘할 수 있는가.

팁
A(Action)에서 “내가 한 것”만 적어. 팀이 한 거 말고.
""",
    },
    {
      "id": "s03",
      "category": "자기소개서",
      "title": "자소서에서 점수 오르는 문장 습관",
      "content": """
점수 오르는 표현
- “근거는 ○○입니다”
- “문제를 ○○로 정의했습니다”
- “우선순위를 ○○로 정했습니다”
- “결과적으로 ○○가 개선됐습니다”

감점 표현
- “열심히 했습니다”만 반복
- “다 같이 했습니다” (내 역할이 안 보임)
- “느꼈습니다”만 있고 행동/결과 없음
""",
    },

    // -------------------------
    // 면접
    // -------------------------
    {
      "id": "g01",
      "category": "면접",
      "title": "면접 1분 자기소개 템플릿 (그대로 따라하기)",
      "content": """
목표
1분 자기소개는 “인상 + 신뢰 + 직무연결”만 만들면 성공.

구조(딱 4줄)
1) 한 줄 정체성: 나는 어떤 사람이다
2) 근거 1개: 경험/프로젝트/성과
3) 직무 연결: 그래서 이 직무에 맞다
4) 마무리: 입사 후 어떻게 기여할지

템플릿
- 안녕하세요. 저는 (키워드 1개) 로 일하는 (직무지향) 입니다.
- (프로젝트/경험) 에서 (내 역할) 로 (성과/결과) 를 만들었습니다.
- 이 과정에서 (직무 핵심역량 1~2개) 를 체득했고, 지원한 (직무명) 에서 바로 쓰일 수 있습니다.
- 입사 후에는 (기여 1개) 로 팀 성과에 보탬이 되겠습니다.

금지
- 학력/나이 나열
- “열심히 하겠습니다”만 반복
- 너무 길게(90초 넘어가면 감점)

리허설 팁
- 3번 연속 말해보고, 녹음 들어보고, 불필요한 말 20% 삭제.
""",
    },
    {
      "id": "g02",
      "category": "면접",
      "title": "STAR 기법: 두서없이 말하는 사람 구제템",
      "content": """
STAR 한 줄 정의
- S: 상황
- T: 내 임무
- A: 내가 한 행동
- R: 결과(수치/변화)

질문이 뭐든 STAR로 귀결 가능
- “갈등 해결?” “실패 경험?” “리더십?” 다 됨.

예시(갈등)
- S: 팀 프로젝트에서 역할 분배가 불공평하다는 의견이 나옴
- T: 일정 지키면서 팀 분위기 회복
- A: 업무량 가시화(칸반/스프레드시트) + 재배치 + 매일 10분 싱크
- R: 마감 2일 전 기능완료, 불만 제로, 다음 프로젝트 재결합
""",
    },
    {
      "id": "g03",
      "category": "면접",
      "title": "카메라 면접: 시선/각도/조명 세팅 한 번에 끝내기",
      "content": """
카메라 각도
- 눈높이보다 살짝 위가 베스트.
- 아래에서 찍히면 피곤/위압 느낌 남.

시선
- 렌즈를 보는 느낌으로.
- 내 얼굴 확인은 1초만.

조명/배경
- 정면 45도 조명 1개
- 배경 정리(흰 벽이면 무난)
""",
    },
    {
      "id": "g04",
      "category": "면접",
      "title": "표정이 딱딱해 보이는 사람 체크리스트",
      "content": """
무표정 해결
1) 입꼬리만 살짝 올리기
2) 문장 끝은 확신 있게
3) 고개 끄덕임 과하게 X

연습
- “안녕하세요” 10번
- “결론은 ○○입니다” 10번
""",
    },
    {
      "id": "g05",
      "category": "면접",
      "title": "추임새(어.. 음..) 줄이는 현실적인 방법",
      "content": """
해결 2개
1) “어/음” 대신 0.5초 멈춤
2) 문장 시작을 결론으로

문장 스타터
- 결론부터 말하면,
- 핵심은 두 가지고,
- 결과적으로,
""",
    },
    {
      "id": "g06",
      "category": "면접",
      "title": "답변 길이: 짧아서 망하는 케이스 방지",
      "content": """
최소 단위
결론 + 근거 + 예시 = 20~30초

꿀팁
마지막에 한 줄:
“입사 후에는 ○○로 기여하겠습니다.”
""",
    },
    {
      "id": "g07",
      "category": "면접",
      "title": "본인의 장단점: 무조건 통과하는 답변 공식",
      "content": """
장점
장점 키워드 → 근거 경험 → 직무 연결

단점
단점 → 보완 행동(현재 진행형) → 결과

금지
- 단점 없습니다
- 성실함이 단점
""",
    },
    {
      "id": "g08",
      "category": "면접",
      "title": "지원동기: 회사 칭찬이 아니라 ‘이유’로 말하기",
      "content": """
3요소
1) 회사 포인트 1개
2) 내 경험 연결
3) 입사 후 기여

팁
‘좋은 회사’는 이유가 아님.
""",
    },
    {
      "id": "g09",
      "category": "면접",
      "title": "갈등 해결: ‘착한 말’ 말고 ‘해결 방식’ 보여주기",
      "content": """
포인트
감정관리 말고 해결 프로세스.

- 문제 정의
- 기준(데이터)
- 합의 방식
- 결과
""",
    },
    {
      "id": "g10",
      "category": "면접",
      "title": "실패 경험: 감점 막는 말투",
      "content": """
금지
남 탓/변명/운

구조
실패 요인(내 책임 포함) → 조치 → 재발 방지 → 다음 결과
""",
    },
    {
      "id": "g11",
      "category": "면접",
      "title": "면접 전날 루틴: 이거만 하면 평균 이상",
      "content": """
- 자기소개 1분 5번
- 예상 질문 5개 STAR 메모
- 회사/직무 한 줄 정리
""",
    },
    {
      "id": "g12",
      "category": "면접",
      "title": "카메라 면접 체크리스트 (촬영 전 10초 점검)",
      "content": """
렌즈 닦기
눈높이 맞추기
조명 정면 45도
배경 정리
방해금지
""",
    },
    {
      "id": "g13",
      "category": "면접",
      "title": "면접 답변 마무리 멘트 10개",
      "content": """
- “결론은 ○○이고, 이를 위해 ○○를 준비했습니다.”
- “제가 이 직무에 적합한 이유는 ○○입니다.”
- “입사 후 3개월 안에 ○○부터 기여하겠습니다.”
""",
    },
    {
      "id": "g14",
      "category": "면접",
      "title": "면접관 역질문 추천 리스트",
      "content": """
추천 질문
- “이 직무에서 성과 좋은 분들의 공통점은?”
- “입사 후 3개월 우선 과제는?”
- “팀 협업에서 중요하게 보는 방식은?”
""",
    },
    {
      "id": "g15",
      "category": "면접",
      "title": "면접에서 바로 점수 오르는 말 습관",
      "content": """
점수 오르는 말 습관
- 결론부터 말하면
- 제가 맡은 역할은
- 근거는 ○○입니다
- 결과는 ○○였습니다
- 그래서 다음엔 ○○로 개선했습니다
""",
    },
    {
      "id": "m16",
      "category": "면접",
      "title": "면접에서 자주 나오는 기술 질문 대응법",
      "content": """
핵심
모르면 솔직 + 대안 제시가 정답.

정답 화법
- “지금은 정확히 모르지만, 제 추정은 ○○이고”
- “확인 방법은 ○○(문서/실험)로 하겠습니다”
- “관련 경험은 ○○가 있습니다”

금지
- 아는 척
- 말 돌리기
""",
    },

    // -------------------------
    // 첫출근
    // -------------------------
    {
      "id": "f01",
      "category": "첫출근",
      "title": "첫 출근 전날 준비: 무조건 챙길 것",
      "content": """
전날
- 알람 2개
- 옷/가방/신분증/지갑 세팅
- 출근 경로 1번 리허설(지도 확인)

당일
- 10분 일찍 도착
- 인사: “안녕하세요, 오늘부터 합류한 ○○입니다”
- 모르는 건 바로 메모
""",
    },
    {
      "id": "f02",
      "category": "첫출근",
      "title": "첫 주에 가장 중요한 태도 5개",
      "content": """
1) 말을 줄이고 메모를 늘리기
2) 약속 시간 5분 전 도착
3) 모르면 “확인하고 다시 말씀드릴게요”
4) 보고는 짧게(결론 → 근거)
5) 파일/문서 정리 습관
""",
    },
    {
      "id": "f03",
      "category": "첫출근",
      "title": "회사 메일/메신저 기본 예절",
      "content": """
메일 제목
- [요청] / [공유] / [보고] 로 시작하면 깔끔함

본문
- 결론 1줄
- 배경 1~2줄
- 요청/다음 행동 1줄

금지
- 감정 섞인 말
- 장문 카톡식 문장
""",
    },
  ];

  List<GuideItem> _defaults() {
    return [
      for (final g in _seedGuides)
        GuideItem(
          id: g['id']!,
          category: g['category']!,
          title: g['title']!,
          content: g['content']!,
          isBookmarked: false,
        ),
    ];
  }

  Future<void> _load() async {
    final bookmarks = await _store.loadBookmarks() ?? const <String>[];
    final base = _defaults();

    state = [
      for (final g in base) g.copyWith(isBookmarked: bookmarks.contains(g.id)),
    ];
  }

  Future<void> _saveBookmarks() async {
    final ids = state.where((g) => g.isBookmarked).map((g) => g.id).toList();
    await _store.saveBookmarks(ids);
  }

  void toggleBookmark(String id) {
    state = [
      for (final g in state)
        if (g.id == id) g.copyWith(isBookmarked: !g.isBookmarked) else g,
    ];
    _saveBookmarks();
  }
}
